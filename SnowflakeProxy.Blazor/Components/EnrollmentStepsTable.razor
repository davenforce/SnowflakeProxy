@using SnowflakeProxy.Core.Services
@using SnowflakeProxy.Core.Models

<ChartComponent
    Query="@QueryString"
    Spec="@VegaSpec"
    ShowMetadata="@ShowMetadata"
    CacheTtl="@CacheTtl" />

@code {
    /// <summary>
    /// Number of enrollment steps to display
    /// </summary>
    [Parameter] public int Limit { get; set; } = 10;

    /// <summary>
    /// Show metadata (row count, cache status)
    /// </summary>
    [Parameter] public bool ShowMetadata { get; set; } = true;

    /// <summary>
    /// Cache TTL
    /// </summary>
    [Parameter] public TimeSpan? CacheTtl { get; set; } = TimeSpan.FromMinutes(10);

    private string QueryString => $"SELECT * FROM DEV_DATAMART.MART.ENROLLMENTS LIMIT {Limit}";

    /// <summary>
    /// Custom VegaLite specification for rendering enrollment data as a table
    /// </summary>
    private object VegaSpec => new
    {
        mark = "rect",
        encoding = new
        {
            y = new
            {
                field = "ENROLLMENT_ID",
                type = "ordinal",
                axis = new { title = "Enrollment ID" }
            },
            x = new
            {
                field = "column",
                type = "nominal",
                axis = new { title = "" }
            },
            color = new
            {
                field = "value",
                type = "nominal",
                legend = null
            },
            text = new
            {
                field = "value",
                type = "nominal"
            }
        },
        config = new
        {
            mark = new { fontSize = 12 }
        }
    };
}
